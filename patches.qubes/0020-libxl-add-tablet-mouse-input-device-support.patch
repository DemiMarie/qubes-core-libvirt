From 0164d543073f3dce4384948fc5a901b5d2ab089d Mon Sep 17 00:00:00 2001
From: Marek Marczykowski <marmarek@invisiblethingslab.com>
Date: Wed, 22 May 2013 06:13:13 +0200
Subject: [PATCH 20/20] libxl: add tablet/mouse input device support
Organization: Invisible Things Lab
Cc: Marek Marczykowski <marmarek@invisiblethingslab.com>

Signed-off-by: Marek Marczykowski <marmarek@invisiblethingslab.com>
---
 src/libxl/libxl_conf.c | 30 ++++++++++++++++++++++++++++++
 1 file changed, 30 insertions(+)

diff --git a/src/libxl/libxl_conf.c b/src/libxl/libxl_conf.c
index f5b8e03..aaf848c 100644
--- a/src/libxl/libxl_conf.c
+++ b/src/libxl/libxl_conf.c
@@ -505,6 +505,36 @@ libxlMakeDomBuildInfo(libxlDriverPrivatePtr driver,
             }
         }
 
+        /* Only the first one is used - b_info->u.hvm.usbdevice doesn't have
+         * space for more (until xen 4.3) */
+        if (def->ninputs) {
+            if (def->ninputs > 1) {
+                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, "%s",
+                        _("This driver supports only one input device"));
+                goto error;
+            }
+            if (def->inputs[0]->bus != VIR_DOMAIN_INPUT_BUS_USB) {
+                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, "%s",
+                        _("libxenlight support only USB input for now"));
+                goto error;
+            }
+
+            switch (def->inputs[0]->type) {
+                case VIR_DOMAIN_INPUT_TYPE_MOUSE:
+                    free(b_info->u.hvm.usbdevice);
+                    b_info->u.hvm.usbdevice = strdup("mouse");
+                    break;
+                case VIR_DOMAIN_INPUT_TYPE_TABLET:
+                    free(b_info->u.hvm.usbdevice);
+                    b_info->u.hvm.usbdevice = strdup("tablet");
+                    break;
+                default:
+                    virReportError(VIR_ERR_CONFIG_UNSUPPORTED, "%s",
+                               _("Unknown input device type"));
+                    goto error;
+            }
+        }
+
         /*
          * The following comment and calculation were taken directly from
          * libxenlight's internal function libxl_get_required_shadow_memory():
-- 
1.8.1.4

